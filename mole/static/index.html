
<html lang="en">
<head>
  <meta charset="utf-8">

  <title>The Mole</title>
  <meta name="description" content="The HTML5 Herald">
  <meta name="author" content="SitePoint">

  <script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>

<body>
  This is the Mole Project. Have fun :D<br>
  <input id="create-button" type="button" value="Create Game"><br>
  <label id="token-label">Game Token:</label><br>
  <input id="start-button" type="button" value="Start Game"><br>
  <input id="join-player" type="button" value="Test Player Join"><br>

  <script>
    $(document).ready(function() {
      let socket = io.connect('');
      let token = '';
      let test_player_id = 0;

      $('#create-button').click(function() {
        socket.emit('create_game', '', function(data) {
          $('#token-label').text('Game Token: ' + data);
          token = data;
        })
      });

      $('#start-button').click(function() {
        socket.emit('start_game', token);
        console.log('game started');
      });

      $('#join-player').click(function() {
        if (token === '') {
          console.error('No game to join!');
          return;
        }
        let player_socket = io.connect('');
        let name = 'test_player' + test_player_id;
        player_socket.on('players_turn', data => {
          console.log(name + ' got players_turn. id: ', data)
        });
        player_socket.on('init', data => { console.log(name + ' got init:', data) });
        player_socket.on('move', data => { console.log(name + ' got move. New position:', data) });
        player_socket.on('chaser_move', data => { console.log(name + ' got chaser move:', data) });
        player_socket.on('minigame', data => { console.log(name + ' got minigame:', data) });
        player_socket.on('occasion', data => { console.log(name + ' got occasion:', data) });
        player_socket.on('player_infos', data => { console.log(name + ' got player infos:', data) });

        player_socket.emit('join_game', {'token': token, 'name': 'test_player' + test_player_id});
        console.log('player "' + name + '" added');
        test_player_id += 1;

        // dice button
        const dice_button = $('<input type="button" value="Dice">');
        dice_button.click(function() {
          const value = Math.floor(Math.random() * 6) + 1
          player_socket.emit('player_choice', {'type': 'dice', 'value': value});
          console.log('diced a', value);
        })

        // occasion button
        const occasion_button = $('<input type="button" value="Random Occasion">');
        occasion_button.click(function() {
          const index = Math.floor(Math.random() * 6)
          const occasion_type = ['found_evidence', 'move_forwards', 'simplify_dicing', 'skip_player', 'move_backwards', 'hinder_dicing'][index]
          const message = {
            'type': occasion_type
          }
          if (occasion_type === 'move_forwards' || occasion_type === 'move_backwards') {
            message['value'] = Math.floor(Math.random() * 4) + 1;
          }
          if (occasion_type === 'skip_player') {
            const index = Math.floor(Math.random() * 3)
            message['name'] = ['test_player0', 'test_player1', 'test_player2'][index]
          }
          player_socket.emit('player_occasion_choice', message);
          console.log('send occasion ', message);
        })
        const body = $("body");
        body.append(dice_button)
        body.append(occasion_button);
        body.append('<br>');
      })
    });
  </script>
</body>
</html>
